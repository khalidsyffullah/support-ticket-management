import{i as B,r as p,c as i,o as l,b as r,d as M,h as c,f as d,a as _,w as h,F as m,j as f,t as u,g as k,e as v,a0 as U,y as I,z as q,k as x}from"./app-CXoDEO4O.js";import{I as F}from"./moment-Zz55rVuQ.js";import{L as A}from"./Layout-xs1QXmZU.js";import{T as E}from"./TextInput-C4slBnbC.js";import{S as T}from"./SelectInput-PYmLIV3U.js";import{S as z}from"./SelectInputFilter-DCj25c_B.js";import{T as D}from"./TextareaInput-BLC7T8Oq.js";import{L}from"./LoadingButton-0Hywptm7.js";import{Q as N}from"./vue-quill.snow-CuIaHiPM.js";import{g as Q}from"./debounce-XMFEkGh1.js";import{_ as R}from"./FlashMessages-DJZZJzeJ.js";import"./v4-SoommWqA.js";const K={components:{LoadingButton:L,SelectInput:T,SelectInputFilter:z,TextInput:E,TextareaInput:D,Link:B,Icon:F,QuillEditor:N},layout:A,props:{customers:Array,usersExceptCustomers:Array,priorities:Array,statuses:Array,types:Array,departments:Array,all_categories:Array,auth:Object,hidden_fields:Object,custom_fields:Object},remember:!1,data(){return{user_access:this.$page.props.auth.user.access,categories:[],sub_categories:[],suggestions:{faqs:[],knowledge_base:[]},form:this.$inertia.form({user_id:null,priority_id:null,status_id:null,department_id:null,category_id:null,sub_category_id:null,assigned_to:null,type_id:null,subject:null,details:"",files:[],custom_field:{}})}},created(){this.setDefaultValue(this.statuses,"status_id","Pending"),this.setDefaultValue(this.priorities,"priority_id","Generally")},methods:{truncate(o,t){return o&&o.length>t?o.substring(0,t)+"...":o},searchSuggestions:Q(function(){if(this.form.subject.split(" ").filter(o=>o!="").length<1){this.suggestions.faqs=[],this.suggestions.knowledge_base=[];return}x.get(this.route("tickets.suggestions",{search:this.form.subject})).then(o=>{this.suggestions=o.data})},500),getCategories(){this.categories=this.all_categories.filter(o=>o.department_id===this.form.department_id),this.form.category_id=null,this.$refs.category.selected=null},getSubCategories(){this.sub_categories=this.all_categories.filter(o=>o.parent_id===this.form.category_id),this.form.sub_category_id=null,this.$refs.sub_category.selected=null},doFilter(o){x.get(this.route("filter.customers",{search:o.target.value})).then(t=>{this.customers.splice(0,this.customers.length,...t.data)})},doFilterUsersExceptCustomer(o){x.get(this.route("filter.users_except_customer",{search:o.target.value})).then(t=>{this.usersExceptCustomers.splice(0,this.usersExceptCustomers.length,...t.data)})},setDefaultValue(o,t,n){const y=o.find(s=>s.name.match(new RegExp(n+".*")));y&&(this.form[t]=y.id)},fileInputChange(o){let t=o.target.files;for(let n=0;n<t.length;n++)this.form.files.push(t[n])},fileRemove(o,t){this.form.files.splice(t,1)},getFileSize(o){const t=Math.floor(Math.log(o)/Math.log(1024));return(o/Math.pow(1024,t)).toFixed(2)*1+" "+["B","kB","MB","GB","TB"][t]},fileBrowse(){this.$refs.file.click()},store(){this.auth.user.role.slug==="customer"&&(this.form.user_id=this.auth.user.id),this.form.post(this.route("tickets.store"))}}},O={class:"bg-white rounded-md shadow overflow-hidden max-w-full"},G={class:"p-8 -mr-6 -mb-8 flex flex-wrap"},H=["value"],P=["value"],Y={value:null},J=["value"],W={value:null},X=["value"],Z={value:null},$=["value"],ee={class:"flex flex-col w-full"},te=["for"],se={key:0,class:"pl-2 text-xs"},re=["onUpdate:modelValue","type","id","placeholder","required"],oe=["id","onUpdate:modelValue","placeholder"],le={key:2,class:"mt-1 text-sm text-gray-500 dark:text-gray-300"},ie={key:7,class:"w-full mb-8"},ne={class:"bg-white border-x border-b border-gray-200 rounded-b-xl shadow-lg"},ue={class:"max-h-[350px] overflow-y-auto p-6 space-y-8"},ae={key:0,class:"space-y-4"},de={class:"flex items-center space-x-2 pb-3 border-b border-gray-100"},me={class:"bg-amber-100 text-amber-800 text-xs font-medium px-2.5 py-0.5 rounded-full"},fe={class:"flex flex-wrap gap-4"},ce=["href"],ge={class:"flex items-start justify-between"},pe={class:"flex-1 min-w-0"},he={class:"font-semibold text-gray-900 group-hover:text-amber-700 transition-colors duration-200 mb-2 line-clamp-2"},be={class:"text-sm text-gray-600 group-hover:text-gray-700 line-clamp-3"},_e={key:1,class:"space-y-4"},ye={class:"flex items-center space-x-2 pb-3 border-b border-gray-100"},ve={class:"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full"},xe={class:"flex flex-wrap gap-4"},we=["href"],ke={class:"flex items-start justify-between"},Ve={class:"flex-1 min-w-0"},Ce={class:"font-semibold text-gray-900 group-hover:text-blue-700 transition-colors duration-200 mb-2 line-clamp-2"},je={class:"text-sm text-gray-600 group-hover:text-gray-700 line-clamp-3"},Se={class:"pr-6 pb-8 w-full"},Be={class:"pr-6 pb-8 w-full lg:w-full flex-col"},Me={class:"flex-1 pr-1"},Ue={class:"text-gray-500 text-xs"},Ie=["onClick"],qe={class:"px-8 py-4 bg-gray-50 border-t border-gray-100 flex justify-end items-center"};function Fe(o,t,n,y,s,a){const w=p("select-input-filter"),b=p("select-input"),V=p("text-input"),C=p("QuillEditor"),j=p("icon"),S=p("loading-button");return l(),i("div",null,[r("div",O,[r("form",{onSubmit:t[13]||(t[13]=M((...e)=>a.store&&a.store(...e),["prevent"]))},[r("div",G,[s.user_access.ticket.update&&n.auth.user.role.slug!=="customer"?(l(),c(w,{key:0,placeholder:"Start typing",onInput:a.doFilter,items:n.customers,modelValue:s.form.user_id,"onUpdate:modelValue":t[0]||(t[0]=e=>s.form.user_id=e),error:s.form.errors.user_id,class:"pr-6 pb-8 w-full lg:w-1/3",label:o.$t("Customer")},null,8,["onInput","items","modelValue","error","label"])):d("",!0),s.user_access.ticket.update&&n.auth.user.role.slug!=="customer"?(l(),c(b,{key:1,modelValue:s.form.priority_id,"onUpdate:modelValue":t[1]||(t[1]=e=>s.form.priority_id=e),error:s.form.errors.priority_id,class:"pr-6 pb-8 w-full lg:w-1/3",label:o.$t("Priority")},{default:h(()=>[t[14]||(t[14]=r("option",{value:null},null,-1)),(l(!0),i(m,null,f(n.priorities,e=>(l(),i("option",{key:e.id,value:e.id},u(e.name),9,H))),128))]),_:1,__:[14]},8,["modelValue","error","label"])):d("",!0),n.hidden_fields&&n.hidden_fields.includes("ticket_type")?d("",!0):(l(),c(b,{key:2,modelValue:s.form.type_id,"onUpdate:modelValue":t[2]||(t[2]=e=>s.form.type_id=e),error:s.form.errors.type_id,class:"pr-6 pb-8 w-full lg:w-1/3",label:o.$t("Type")},{default:h(()=>[t[15]||(t[15]=r("option",{value:null},null,-1)),(l(!0),i(m,null,f(n.types,e=>(l(),i("option",{key:e.id,value:e.id},u(e.name),9,P))),128))]),_:1,__:[15]},8,["modelValue","error","label"])),!(n.hidden_fields&&n.hidden_fields.includes("department"))&&n.auth.user.role.slug!=="customer"?(l(),c(b,{key:3,onChange:t[3]||(t[3]=e=>a.getCategories()),modelValue:s.form.department_id,"onUpdate:modelValue":t[4]||(t[4]=e=>s.form.department_id=e),error:s.form.errors.department_id,class:"pr-6 pb-5 md:col-span-6 lg:w-1/3",label:o.$t("Department")},{default:h(()=>[r("option",Y,u(o.$t("Select a department")),1),(l(!0),i(m,null,f(n.departments,e=>(l(),i("option",{key:e.id,value:e.id},u(e.name),9,J))),128))]),_:1},8,["modelValue","error","label"])):d("",!0),!(n.hidden_fields&&n.hidden_fields.includes("category"))&&s.form.department_id?(l(),c(b,{key:4,ref:"category",onChange:t[5]||(t[5]=e=>a.getSubCategories()),modelValue:s.form.category_id,"onUpdate:modelValue":t[6]||(t[6]=e=>s.form.category_id=e),error:s.form.errors.category_id,class:"pb-5 pr-6 md:col-span-6 lg:w-1/3",label:o.$t("Category")},{default:h(()=>[r("option",W,u(o.$t("Select a category")),1),(l(!0),i(m,null,f(s.categories,e=>(l(),i("option",{key:e.id,value:e.id},u(e.name),9,X))),128))]),_:1},8,["modelValue","error","label"])):d("",!0),s.form.category_id?(l(),c(b,{key:5,ref:"sub_category",modelValue:s.form.sub_category_id,"onUpdate:modelValue":t[7]||(t[7]=e=>s.form.sub_category_id=e),error:s.form.errors.sub_category_id,class:"pb-5 md:col-span-6 lg:w-1/3",label:o.$t("Sub Category")},{default:h(()=>[r("option",Z,u(o.$t("Select a sub category")),1),(l(!0),i(m,null,f(s.sub_categories,e=>(l(),i("option",{key:e.id,value:e.id},u(e.name),9,$))),128))]),_:1},8,["modelValue","error","label"])):d("",!0),n.auth.user.role.slug!=="customer"&&s.user_access.ticket.update&&!(n.hidden_fields&&n.hidden_fields.includes("assigned_to"))?(l(),c(w,{key:6,placeholder:"Start typing",onInput:a.doFilterUsersExceptCustomer,items:n.usersExceptCustomers,modelValue:s.form.assigned_to,"onUpdate:modelValue":t[8]||(t[8]=e=>s.form.assigned_to=e),error:s.form.errors.assigned_to,class:"pr-6 pb-8 w-full lg:w-1/3",label:o.$t("Assigned to")},null,8,["onInput","items","modelValue","error","label"])):d("",!0),(l(!0),i(m,null,f(n.custom_fields,e=>(l(),i("div",{class:"pr-6 pb-8 w-full lg:w-1/3",key:e.id},[r("div",ee,[r("label",{for:["checkbox"].includes(e.type)?null:"ticket_field_"+e.id,class:"form-label"},[v(u(e.label)+" ",1),e.required?d("",!0):(l(),i("small",se,"(optional)"))],8,te),["text","email","number"].includes(e.type)?k((l(),i("input",{key:0,"onUpdate:modelValue":g=>s.form.custom_field[e.name]=g,type:e.type,id:"ticket_field_"+e.id,placeholder:e.placeholder,required:e.required,class:"form-input"},null,8,re)),[[U,s.form.custom_field[e.name]]]):d("",!0),e.type==="textarea"?k((l(),i("textarea",{key:1,id:"ticket_field_"+e.id,rows:"2","onUpdate:modelValue":g=>s.form.custom_field[e.name]=g,class:"form-textarea",placeholder:e.placeholder},null,8,oe)),[[I,s.form.custom_field[e.name]]]):d("",!0),e.hint?(l(),i("p",le,u(e.hint),1)):d("",!0)])]))),128)),_(V,{modelValue:s.form.subject,"onUpdate:modelValue":t[9]||(t[9]=e=>s.form.subject=e),error:s.form.errors.subject,class:"pr-6 pb-8 w-full lg:w-full",label:o.$t("Subject"),onKeyup:a.searchSuggestions},null,8,["modelValue","error","label","onKeyup"]),s.suggestions.faqs.length||s.suggestions.knowledge_base.length?(l(),i("div",ie,[t[22]||(t[22]=q('<div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-4 rounded-t-xl" data-v-7fe9ccff><div class="flex items-center space-x-3" data-v-7fe9ccff><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-7fe9ccff><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" data-v-7fe9ccff></path></svg><h2 class="text-xl font-semibold" data-v-7fe9ccff> You may also find solutions in these topics </h2></div></div>',1)),r("div",ne,[r("div",ue,[s.suggestions.faqs.length?(l(),i("div",ae,[r("div",de,[t[16]||(t[16]=r("svg",{class:"w-5 h-5 text-amber-500",fill:"currentColor",viewBox:"0 0 20 20"},[r("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z","clip-rule":"evenodd"})],-1)),t[17]||(t[17]=r("h3",{class:"text-lg font-bold text-gray-800"}," Frequently Asked Questions ",-1)),r("span",me,u(s.suggestions.faqs.length),1)]),r("div",fe,[(l(!0),i(m,null,f(s.suggestions.faqs,e=>(l(),i("div",{key:"faq-"+e.id,class:"group relative bg-gradient-to-r from-amber-50 to-orange-50 hover:from-amber-100 hover:to-orange-100 rounded-lg border border-amber-200 hover:border-amber-300 transition-all duration-200 hover:shadow-md"},[r("a",{href:o.route("faq"),target:"_blank",class:"block p-4 h-full"},[r("div",ge,[r("div",pe,[r("h4",he,u(e.name),1),r("p",be,u(a.truncate(e.details,170)),1)]),t[18]||(t[18]=r("svg",{class:"w-5 h-5 text-amber-400 group-hover:text-amber-600 transition-colors duration-200 ml-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})],-1))])],8,ce)]))),128))])])):d("",!0),s.suggestions.knowledge_base.length?(l(),i("div",_e,[r("div",ye,[t[19]||(t[19]=r("svg",{class:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20"},[r("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t[20]||(t[20]=r("h3",{class:"text-lg font-bold text-gray-800"},"Knowledge Base",-1)),r("span",ve,u(s.suggestions.knowledge_base.length),1)]),r("div",xe,[(l(!0),i(m,null,f(s.suggestions.knowledge_base,e=>(l(),i("div",{key:"kb-"+e.id,class:"group relative bg-gradient-to-r from-blue-50 to-indigo-50 hover:from-blue-100 hover:to-indigo-100 rounded-lg border border-blue-200 hover:border-blue-300 transition-all duration-200 hover:shadow-md"},[r("a",{href:o.route("kb.details",e.id),target:"_blank",class:"block p-4 h-full"},[r("div",ke,[r("div",Ve,[r("h4",Ce,u(e.title),1),r("p",je,u(a.truncate(e.details,170)),1)]),t[21]||(t[21]=r("svg",{class:"w-5 h-5 text-blue-400 group-hover:text-blue-600 transition-colors duration-200 ml-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})],-1))])],8,we)]))),128))])])):d("",!0)])])])):d("",!0),r("div",Se,[t[23]||(t[23]=r("label",{class:"form-label"},"Request Details:",-1)),_(C,{theme:"snow",toolbar:"full",content:s.form.details,"onUpdate:content":t[10]||(t[10]=e=>s.form.details=e),contentType:"html"},null,8,["content"])]),r("input",{ref:"file",type:"file",accept:".xlsx,.xls,image/*,.doc, .docx,.ppt, .pptx,.txt,.pdf, .zip",class:"hidden",multiple:"multiple",onChange:t[11]||(t[11]=(...e)=>a.fileInputChange&&a.fileInputChange(...e))},null,544),r("div",Be,[r("button",{type:"button",class:"btn flex justify-center items-center",onClick:t[12]||(t[12]=(...e)=>a.fileBrowse&&a.fileBrowse(...e))},[_(j,{name:"file",class:"flex-shrink-0 h-8 fill-gray-400 pr-1"}),r("h4",null,u(o.$t("Attach files")),1)]),s.form.files.length?(l(!0),i(m,{key:0},f(s.form.files,(e,g)=>(l(),i("div",{class:"flex items-center justify-between pr-6 pt-8 w-full lg:w-1/2",key:g},[r("div",Me,[v(u(e.name)+" ",1),r("span",Ue,"("+u(a.getFileSize(e.size))+")",1)]),r("button",{type:"button",class:"btn flex justify-center items-center",onClick:Ae=>a.fileRemove(e,g)},u(o.$t("Remove")),9,Ie)]))),128)):d("",!0)])]),r("div",qe,[_(S,{loading:s.form.processing,class:"btn-indigo",type:"submit"},{default:h(()=>[v(u(o.$t("Create"))+" "+u(o.$t("Ticket")),1)]),_:1},8,["loading"])])],32)])])}const Pe=R(K,[["render",Fe],["__scopeId","data-v-7fe9ccff"]]);export{Pe as default};
