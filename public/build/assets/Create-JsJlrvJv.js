import{i as j,r as g,c as u,o as s,b as i,d as B,h as m,f as d,a as h,w as _,F as f,j as p,t as n,g as x,e as b,Y as I,A as E,k as V}from"./app-iELrXvhl.js";import{I as F}from"./moment-BsU-6nlK.js";import{L as A}from"./Layout-ByaCvUZi.js";import{T}from"./TextInput-DqP9yEI0.js";import{S as D}from"./SelectInput-CHXsTU7n.js";import{S as M}from"./SelectInputFilter-Cwa9nftD.js";import{T as L}from"./TextareaInput-C7FqX3BV.js";import{L as q}from"./LoadingButton-BY1V1iLc.js";import{Q as R}from"./vue-quill.snow-IQ1kiXwp.js";import{_ as N}from"./FlashMessages-CMPwX36p.js";import"./v4-SoommWqA.js";const Q={components:{LoadingButton:q,SelectInput:D,SelectInputFilter:M,TextInput:T,TextareaInput:L,Link:j,Icon:F,QuillEditor:R},layout:A,props:{customers:Array,usersExceptCustomers:Array,priorities:Array,statuses:Array,types:Array,departments:Array,all_categories:Array,auth:Object,hidden_fields:Object,custom_fields:Object},remember:!1,data(){return{user_access:this.$page.props.auth.user.access,categories:[],sub_categories:[],form:this.$inertia.form({user_id:null,priority_id:null,status_id:null,department_id:null,category_id:null,sub_category_id:null,assigned_to:null,type_id:null,subject:null,details:"",files:[],custom_field:{}})}},created(){this.setDefaultValue(this.statuses,"status_id","Pending"),this.setDefaultValue(this.priorities,"priority_id","Generally")},methods:{getCategories(){this.categories=this.all_categories.filter(r=>r.department_id===this.form.department_id),this.form.category_id=null,this.$refs.category.selected=null},getSubCategories(){this.sub_categories=this.all_categories.filter(r=>r.parent_id===this.form.category_id),this.form.sub_category_id=null,this.$refs.sub_category.selected=null},doFilter(r){V.get(this.route("filter.customers",{search:r.target.value})).then(t=>{this.customers.splice(0,this.customers.length,...t.data)})},doFilterUsersExceptCustomer(r){V.get(this.route("filter.users_except_customer",{search:r.target.value})).then(t=>{this.usersExceptCustomers.splice(0,this.usersExceptCustomers.length,...t.data)})},setDefaultValue(r,t,o){const v=r.find(l=>l.name.match(new RegExp(o+".*")));v&&(this.form[t]=v.id)},fileInputChange(r){let t=r.target.files;for(let o=0;o<t.length;o++)this.form.files.push(t[o])},fileRemove(r,t){this.form.files.splice(t,1)},getFileSize(r){const t=Math.floor(Math.log(r)/Math.log(1024));return(r/Math.pow(1024,t)).toFixed(2)*1+" "+["B","kB","MB","GB","TB"][t]},fileBrowse(){this.$refs.file.click()},store(){this.form.user_id=this.auth.user.id,this.form.post(this.route("tickets.store"))}}},z={class:"bg-white rounded-md shadow overflow-hidden max-w-full"},O={class:"p-8 -mr-6 -mb-8 flex flex-wrap"},G=["value"],P=["value"],Y={value:null},H=["value"],J={value:null},K=["value"],W={value:null},X=["value"],Z={class:"flex flex-col w-full"},$=["for"],ee={key:0,class:"pl-2 text-xs"},te=["onUpdate:modelValue","type","id","placeholder","required"],le=["id","onUpdate:modelValue","placeholder"],re={key:2,class:"mt-1 text-sm text-gray-500 dark:text-gray-300"},se={class:"pr-6 pb-8 w-full"},oe={class:"pr-6 pb-8 w-full lg:w-full flex-col"},ie={class:"flex-1 pr-1"},ue={class:"text-gray-500 text-xs"},ne=["onClick"],ae={class:"px-8 py-4 bg-gray-50 border-t border-gray-100 flex justify-end items-center"};function de(r,t,o,v,l,a){const w=g("select-input-filter"),y=g("select-input"),C=g("text-input"),k=g("QuillEditor"),S=g("icon"),U=g("loading-button");return s(),u("div",null,[i("div",z,[i("form",{onSubmit:t[13]||(t[13]=B((...e)=>a.store&&a.store(...e),["prevent"]))},[i("div",O,[l.user_access.ticket.update&&o.auth.user.role.slug!=="customer"?(s(),m(w,{key:0,placeholder:"Start typing",onInput:a.doFilter,items:o.customers,modelValue:l.form.user_id,"onUpdate:modelValue":t[0]||(t[0]=e=>l.form.user_id=e),error:l.form.errors.user_id,class:"pr-6 pb-8 w-full lg:w-1/3",label:r.$t("Customer")},null,8,["onInput","items","modelValue","error","label"])):d("",!0),l.user_access.ticket.update?(s(),m(y,{key:1,modelValue:l.form.priority_id,"onUpdate:modelValue":t[1]||(t[1]=e=>l.form.priority_id=e),error:l.form.errors.priority_id,class:"pr-6 pb-8 w-full lg:w-1/3",label:r.$t("Priority")},{default:_(()=>[t[14]||(t[14]=i("option",{value:null},null,-1)),(s(!0),u(f,null,p(o.priorities,e=>(s(),u("option",{key:e.id,value:e.id},n(e.name),9,G))),128))]),_:1,__:[14]},8,["modelValue","error","label"])):d("",!0),o.hidden_fields&&o.hidden_fields.includes("ticket_type")?d("",!0):(s(),m(y,{key:2,modelValue:l.form.type_id,"onUpdate:modelValue":t[2]||(t[2]=e=>l.form.type_id=e),error:l.form.errors.type_id,class:"pr-6 pb-8 w-full lg:w-1/3",label:r.$t("Type")},{default:_(()=>[t[15]||(t[15]=i("option",{value:null},null,-1)),(s(!0),u(f,null,p(o.types,e=>(s(),u("option",{key:e.id,value:e.id},n(e.name),9,P))),128))]),_:1,__:[15]},8,["modelValue","error","label"])),o.hidden_fields&&o.hidden_fields.includes("department")?d("",!0):(s(),m(y,{key:3,onChange:t[3]||(t[3]=e=>a.getCategories()),modelValue:l.form.department_id,"onUpdate:modelValue":t[4]||(t[4]=e=>l.form.department_id=e),error:l.form.errors.department_id,class:"pr-6 pb-5 md:col-span-6 lg:w-1/3",label:r.$t("Department")},{default:_(()=>[i("option",Y,n(r.$t("Select a department")),1),(s(!0),u(f,null,p(o.departments,e=>(s(),u("option",{key:e.id,value:e.id},n(e.name),9,H))),128))]),_:1},8,["modelValue","error","label"])),!(o.hidden_fields&&o.hidden_fields.includes("category"))&&l.form.department_id?(s(),m(y,{key:4,ref:"category",onChange:t[5]||(t[5]=e=>a.getSubCategories()),modelValue:l.form.category_id,"onUpdate:modelValue":t[6]||(t[6]=e=>l.form.category_id=e),error:l.form.errors.category_id,class:"pb-5 pr-6 md:col-span-6 lg:w-1/3",label:r.$t("Category")},{default:_(()=>[i("option",J,n(r.$t("Select a category")),1),(s(!0),u(f,null,p(l.categories,e=>(s(),u("option",{key:e.id,value:e.id},n(e.name),9,K))),128))]),_:1},8,["modelValue","error","label"])):d("",!0),l.form.category_id?(s(),m(y,{key:5,ref:"sub_category",modelValue:l.form.sub_category_id,"onUpdate:modelValue":t[7]||(t[7]=e=>l.form.sub_category_id=e),error:l.form.errors.sub_category_id,class:"pb-5 md:col-span-6 lg:w-1/3",label:r.$t("Sub Category")},{default:_(()=>[i("option",W,n(r.$t("Select a sub category")),1),(s(!0),u(f,null,p(l.sub_categories,e=>(s(),u("option",{key:e.id,value:e.id},n(e.name),9,X))),128))]),_:1},8,["modelValue","error","label"])):d("",!0),o.auth.user.role.slug!=="customer"&&l.user_access.ticket.update&&!(o.hidden_fields&&o.hidden_fields.includes("assigned_to"))?(s(),m(w,{key:6,placeholder:"Start typing",onInput:a.doFilterUsersExceptCustomer,items:o.usersExceptCustomers,modelValue:l.form.assigned_to,"onUpdate:modelValue":t[8]||(t[8]=e=>l.form.assigned_to=e),error:l.form.errors.assigned_to,class:"pr-6 pb-8 w-full lg:w-1/3",label:r.$t("Assigned to")},null,8,["onInput","items","modelValue","error","label"])):d("",!0),(s(!0),u(f,null,p(o.custom_fields,e=>(s(),u("div",{class:"pr-6 pb-8 w-full lg:w-1/3",key:e.id},[i("div",Z,[i("label",{for:["checkbox"].includes(e.type)?null:"ticket_field_"+e.id,class:"form-label"},[b(n(e.label)+" ",1),e.required?d("",!0):(s(),u("small",ee,"(optional)"))],8,$),["text","email","number"].includes(e.type)?x((s(),u("input",{key:0,"onUpdate:modelValue":c=>l.form.custom_field[e.name]=c,type:e.type,id:"ticket_field_"+e.id,placeholder:e.placeholder,required:e.required,class:"form-input"},null,8,te)),[[I,l.form.custom_field[e.name]]]):d("",!0),e.type==="textarea"?x((s(),u("textarea",{key:1,id:"ticket_field_"+e.id,rows:"2","onUpdate:modelValue":c=>l.form.custom_field[e.name]=c,class:"form-textarea",placeholder:e.placeholder},null,8,le)),[[E,l.form.custom_field[e.name]]]):d("",!0),e.hint?(s(),u("p",re,n(e.hint),1)):d("",!0)])]))),128)),h(C,{modelValue:l.form.subject,"onUpdate:modelValue":t[9]||(t[9]=e=>l.form.subject=e),error:l.form.errors.subject,class:"pr-6 pb-8 w-full lg:w-full",label:r.$t("Subject")},null,8,["modelValue","error","label"]),i("div",se,[t[16]||(t[16]=i("label",{class:"form-label"},"Request Details:",-1)),h(k,{theme:"snow",toolbar:"full",content:l.form.details,"onUpdate:content":t[10]||(t[10]=e=>l.form.details=e),contentType:"html"},null,8,["content"])]),i("input",{ref:"file",type:"file",accept:".xlsx,.xls,image/*,.doc, .docx,.ppt, .pptx,.txt,.pdf, .zip",class:"hidden",multiple:"multiple",onChange:t[11]||(t[11]=(...e)=>a.fileInputChange&&a.fileInputChange(...e))},null,544),i("div",oe,[i("button",{type:"button",class:"btn flex justify-center items-center",onClick:t[12]||(t[12]=(...e)=>a.fileBrowse&&a.fileBrowse(...e))},[h(S,{name:"file",class:"flex-shrink-0 h-8 fill-gray-400 pr-1"}),t[17]||(t[17]=b()),i("h4",null,n(r.$t("Attach files")),1)]),l.form.files.length?(s(!0),u(f,{key:0},p(l.form.files,(e,c)=>(s(),u("div",{class:"flex items-center justify-between pr-6 pt-8 w-full lg:w-1/2",key:c},[i("div",ie,[b(n(e.name)+" ",1),i("span",ue,"("+n(a.getFileSize(e.size))+")",1)]),i("button",{type:"button",class:"btn flex justify-center items-center",onClick:me=>a.fileRemove(e,c)},n(r.$t("Remove")),9,ne)]))),128)):d("",!0)])]),i("div",ae,[h(U,{loading:l.form.processing,class:"btn-indigo",type:"submit"},{default:_(()=>[b(n(r.$t("Create"))+" "+n(r.$t("Ticket")),1)]),_:1},8,["loading"])])],32)])])}const Ve=N(Q,[["render",de]]);export{Ve as default};
