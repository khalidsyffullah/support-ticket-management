import{I as w,h as k}from"./moment-BsU-6nlK.js";import{t as b,S as M,p as j}from"./SearchInput-DcL1ZzRw.js";import{L}from"./Layout-ByaCvUZi.js";import{m as C}from"./mapValues-hAUeR5ZO.js";import{P as N}from"./Pagination-B6SQBIwv.js";import{Z as H,i as T,r as h,c as r,o as l,a as _,b as t,t as i,f as n,F as f,j as m,h as V,w as E,n as S,k as A}from"./app-iELrXvhl.js";import{Q as B}from"./vue-quill.snow-IQ1kiXwp.js";import{_ as I}from"./FlashMessages-CMPwX36p.js";const O={metaInfo:{title:"Chat"},components:{SearchInput:M,Icon:w,Pagination:N,Link:T,Head:H,QuillEditor:B},layout:L,props:{filters:Object,conversations:Object,chat:Object,title:String},remember:"form",data(){return{message:"",user:this.$page.props.auth.user,user_access:this.$page.props.auth.user.access,form:{search:this.filters.search}}},watch:{form:{deep:!0,handler:b(function(){this.$inertia.get(this.route("chat"),j(this.form),{preserveState:!0})},150)}},methods:{textOnly(s){return s.replace(/(<([^>]+)>)/ig,"")},reset(){this.form=C(this.form,()=>null)},sendMessage(){var s=this;const a={message:this.message,user_id:this.user.id,_token:this.$page.props.csrf_token,conversation_id:this.chat.id};this.message="",A.post(this.route("chat.message"),a).then(o=>{o.data&&s.chat.messages.push(o.data),this.$emit("message sent!")}).catch(o=>{console.log(o)})},navigateTo(s){window.location.href=this.route("chat.current",s)},destroy(s){let a=this;confirm("Are you sure you want to delete this conversation?")&&this.$inertia.delete(this.route("chat.destroy",s),{onSuccess:()=>{setTimeout(function(){a.reset()},4e3)}})},restore(s){confirm("Are you sure you want to restore this conversation?")&&this.$inertia.put(this.route("chat.restore",s))},pushMessage(s){let a=this.conversations.data.find(o=>o.id===s.conversation_id);typeof a=="object"?(a.title=s.message,a.total_entry=a.total_entry+1,this.chat&&this.chat.id===s.conversation_id&&(this.chat.messages.push(s),a.total_entry=0)):this.conversations.data.unshift({id:s.conversation_id,total_entry:1,title:s.message,creator:s.creator,updated_at:s.updated_at})}},created(){this.moment=k;let s=this;window.Echo&&window.Echo.private("messages").listen("NewChatMessage",function(a){typeof a.chatMessage=="object"&&s.pushMessage(a.chatMessage)})}},D={class:"main flex-1 flex flex-col sec_chat"},Q={class:"flex-1 flex h-full gap-5"},F={class:"sidebar h-full hidden lg:flex w-1/3 flex-2 flex-col bg-white"},P={class:"chat-box h-full"},R={class:"chat-left-aside h-full"},U={class:"c-top"},z={class:"media mb-1"},Z=["src"],q={key:1,src:"/images/svg/profile.svg",alt:"",class:"rounded-circle rounded-full user-image"},G={class:"about"},J={class:"name f-w-600"},K={class:"status"},W={class:"search flex-2 py-2"},X={class:"c-list"},Y={class:"flex-1 h-full overflow-hidden overflow-y-auto pt-2"},$={class:"flex-2"},tt={class:"w-12 h-12 relative"},et={class:"w-12 h-12 rounded-full mx-auto user_icon",alt:"chat-user"},st={class:"flex-1 px-2"},ot={class:"truncate w-32"},at={class:""},it={key:0,class:"mt-1"},lt={class:"text-gray-600"},rt={key:1,class:"mt-1 truncate w-32"},ct={class:"text-gray-600 text-xs"},nt={class:"flex-2 text-right"},dt={class:"text-gray-500"},ht={key:0,class:"text-xs bg-red-500 text-white rounded-full h-6 w-6 leading-6 text-center inline-block"},_t={key:0,class:"flex w-full h-full justify-center items-center text-gray-500"},ut={class:"chat-area h-full w-2/3 flex-1 flex flex-col bg-white"},ft={class:"flex-3"},mt={key:0,class:"chat-header flex pb-3 justify-between"},vt={class:"flex"},xt={class:"w-12 h-12 relative mr-3"},yt={class:"w-12 h-12 rounded-full mx-auto user_icon",title:"{{ chat.creator.first_name }} {{ chat.creator.last_name }}"},gt={class:"flex flex-col pt-1"},pt={class:"name"},wt={class:"status digits pt-2"},kt={class:"messages flex-1 overflow-auto reverse__order"},bt={key:0,class:"flex-2"},Mt={class:"w-12 h-12 relative"},jt={class:"w-12 h-12 rounded-full mx-auto user_icon"},Lt={key:1,class:"flex-1 px-2 mt__wrap"},Ct=["innerHTML"],Nt={class:"pl-4"},Ht={class:"text-gray-500"},Tt={key:2,class:"flex-1 px-2 text-right mt__wrap"},Vt=["innerHTML"],Et={class:"pr-4"},St={class:"text-gray-500"},At={key:1,class:"flex w-full h-full justify-center items-center text-gray-500"},Bt={key:2,class:"flex w-full h-full justify-center items-center text-gray-500"},It={key:0,class:"flex-2 pt-4 pb-3"},Ot={class:"write bg-white shadow flex rounded-lg"},Dt={class:"flex-1 ticket_comment_edit"},Qt={class:"flex-2 w-35 p-2 flex content-center items-center"},Ft={class:"flex-1"};function Pt(s,a,o,Rt,c,d){const v=h("Head"),x=h("search-input"),y=h("Link"),u=h("icon"),g=h("QuillEditor");return l(),r("div",null,[_(v,{title:s.$t(o.title)},null,8,["title"]),t("div",D,[t("div",Q,[t("div",F,[t("div",P,[t("div",R,[t("div",U,[t("div",z,[c.user.photo?(l(),r("img",{key:0,src:c.user.photo,alt:"",class:"rounded-circle rounded-full user-image"},null,8,Z)):(l(),r("img",q)),t("div",G,[t("div",J,i(c.user.first_name)+" "+i(c.user.last_name),1),t("div",K,i(s.$t(c.user.role.name)),1)])]),t("div",W,[_(x,{modelValue:c.form.search,"onUpdate:modelValue":a[0]||(a[0]=e=>c.form.search=e),class:"w-full",onReset:d.reset},null,8,["modelValue","onReset"])])]),t("div",X,[t("div",Y,[(l(!0),r(f,null,m(o.conversations.data,e=>(l(),V(y,{key:e.id,href:s.route("chat.current",e.slug||e.id),class:S(["entry cursor-pointer transform hover:scale-105 duration-300 transition-transform mb-4 rounded p-4 mx-5 flex shadow-md",{"border-l-4 border-red-500":o.chat&&e.id===o.chat.id}])},{default:E(()=>[t("div",$,[t("div",tt,[t("span",et,i(Array.from(e.creator.first_name)[0]),1)])]),t("div",st,[t("div",ot,[t("span",at,i(e.creator.first_name)+" "+i(e.creator.last_name),1)]),e.creator.email?(l(),r("div",it,[t("small",lt,i(e.creator.email),1)])):n("",!0),e.title?(l(),r("div",rt,[t("small",ct,i(d.textOnly(e.title)),1)])):n("",!0)]),t("div",nt,[t("div",null,[t("small",dt,i(s.moment(e.updated_at).format("DD MMM")),1)]),t("div",null,[e.total_entry?(l(),r("small",ht,i(e.total_entry),1)):n("",!0)])])]),_:2},1032,["href","class"]))),128)),o.conversations.data.length?n("",!0):(l(),r("div",_t,i(s.$t("No conversation found.")),1))])])])])]),t("div",ut,[t("div",ft,[o.chat?(l(),r("div",mt,[t("div",vt,[t("div",xt,[t("span",yt,i(Array.from(o.chat.creator.first_name)[0]),1)]),t("div",gt,[t("div",pt,i(o.chat.creator.first_name)+" "+i(o.chat.creator.last_name),1),t("div",wt,i(o.chat.creator.email),1)])]),c.user_access.chat.delete?(l(),r("div",{key:0,class:"flex justify-center mr-3 items-center cursor-pointer",onClick:a[1]||(a[1]=e=>d.destroy(o.chat.id))},[_(u,{name:"trash",class:"w-5 h-5"})])):n("",!0)])):n("",!0)]),t("div",kt,[o.chat&&o.chat.messages.length?(l(!0),r(f,{key:0},m(o.chat.messages.slice().reverse(),(e,p)=>(l(),r("div",{key:p,class:"message mb-4 flex"},[!e.user_id&&e.contact&&e.contact.first_name?(l(),r("div",bt,[t("div",Mt,[t("span",jt,i(Array.from(e.contact.first_name)[0]),1)])])):n("",!0),e.user_id?n("",!0):(l(),r("div",Lt,[t("div",{class:"inline-block bg-gray-300 rounded p-2 px-3 text-gray-700 leading-5 ckc",innerHTML:e.message},null,8,Ct),t("div",Nt,[t("small",Ht,i(s.moment(e.updated_at).fromNow(!0)),1)])])),e.user_id?(l(),r("div",Tt,[t("div",{class:"inline-block bg-blue-600 rounded p-2 px-3 text-white leading-5 ckc",innerHTML:e.message},null,8,Vt),t("div",Et,[t("small",St,i(s.moment(e.updated_at).fromNow(!0)),1)])])):n("",!0)]))),128)):o.chat&&!o.chat.messages.length?(l(),r("div",At,i(s.$t("No history found for this conversation")),1)):(l(),r("div",Bt,i(s.$t("Click on a conversation from left to see the histories.")),1))]),o.chat?(l(),r("div",It,[t("div",Ot,[t("div",Dt,[_(g,{theme:"snow",toolbar:"full",content:c.message,"onUpdate:content":a[2]||(a[2]=e=>c.message=e),contentType:"html"},null,8,["content"])]),t("div",Qt,[t("div",Ft,[t("button",{class:"bg-blue-400 w-10 h-10 rounded-full flex justify-center items-center",onClick:a[3]||(a[3]=(...e)=>d.sendMessage&&d.sendMessage(...e))},[_(u,{class:"w-4 h-4 fill-gray-100",name:"send"})])])])])])):n("",!0)])])])])}const Xt=I(O,[["render",Pt]]);export{Xt as default};
